<div class="admin-container">
  <div class="header">
    <button class="btn-back" (click)="volverAlDashboard()">← Volver</button>
    <h1>Gestión de Preguntas</h1>
    <button class="btn-nuevo" (click)="mostrarNuevoFormulario()" *ngIf="!mostrarFormulario">
      + Nueva Pregunta
    </button>
  </div>

  <div *ngIf="mensaje" class="mensaje-exito">{{ mensaje }}</div>
  <div *ngIf="error" class="mensaje-error">{{ error }}</div>

  <div *ngIf="mostrarFormulario" class="form-card">
    <h3>{{ modoEdicion ? 'Editar Pregunta' : 'Nueva Pregunta' }}</h3>
    <form (ngSubmit)="guardarPregunta()" #preguntaForm="ngForm">
      <div class="form-group">
        <label for="habilidad">Habilidad * (Dropdown - No manual)</label>
        <select 
          id="habilidad" 
          name="habilidad"
          [(ngModel)]="nuevaPregunta.habilidadId"
          (focus)="limpiarMensajes()"
          required
        >
          <option value="0">Seleccione una habilidad</option>
          <option *ngFor="let habilidad of habilidades" [value]="habilidad.id">
            {{ habilidad.nombre }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="tipoPregunta">Tipo de Pregunta *</label>
        <select 
          id="tipoPregunta" 
          name="tipoPregunta"
          [(ngModel)]="nuevaPregunta.tipoPregunta"
          (focus)="limpiarMensajes()"
          required
        >
          <option value="">Seleccione un tipo</option>
          <option *ngFor="let tipo of tiposPregunta" [value]="tipo">
            {{ getTipoLabel(tipo) }}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label for="pregunta">Pregunta *</label>
        <textarea 
          id="pregunta" 
          name="pregunta"
          [(ngModel)]="nuevaPregunta.pregunta"
          (focus)="limpiarMensajes()"
          required
          rows="4"
          placeholder="Escribe la pregunta completa..."
          maxlength="500"
        ></textarea>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-guardar" [disabled]="!preguntaForm.form.valid || guardando">
          {{ guardando ? 'Guardando...' : modoEdicion ? 'Actualizar' : 'Guardar' }}
        </button>
        <button type="button" class="btn-cancelar" (click)="cancelarFormulario()">
          Cancelar
        </button>
      </div>
    </form>
  </div>

  <div class="tabla-card">
    <h3>Lista de Preguntas ({{ preguntas.length }})</h3>
    
    <div *ngIf="cargando" class="loading">Cargando preguntas...</div>

    <div *ngIf="!cargando && preguntas.length === 0" class="no-data">
      <p>No hay preguntas registradas</p>
    </div>

    <table *ngIf="!cargando && preguntas.length > 0">
      <thead>
        <tr>
          <th>Habilidad</th>
          <th>Tipo</th>
          <th>Pregunta</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let pregunta of preguntas">
          <td><span class="badge-habilidad">{{ pregunta.habilidadNombre }}</span></td>
          <td>
            <span class="badge-tipo" [class.preferencia]="pregunta.tipoPregunta === 'GUSTO' || pregunta.tipoPregunta === 'PREFERENCIA'">
              {{ getTipoLabel(pregunta.tipoPregunta) }}
            </span>
          </td>
          <td class="pregunta-texto">{{ pregunta.pregunta }}</td>
          <td class="acciones">
            <button class="btn-editar" (click)="editarPregunta(pregunta)">Editar</button>
            <button class="btn-eliminar" (click)="eliminarPregunta(pregunta.id!, pregunta.pregunta)">Eliminar</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="info-box">
    <p><strong>PREFERENCIA:</strong> Evalúa el interés del estudiante en actividades relacionadas con la habilidad.</p>
    <p><strong>AUTOEVALUACIÓN:</strong> Evalúa la percepción del estudiante sobre su nivel de competencia.</p>
    <p><strong>Nota:</strong> Seleccione la habilidad desde el menú desplegable.</p>
  </div>
</div>
